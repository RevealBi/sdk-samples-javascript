<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reveal Sdk - Web Component</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" type="text/css">
    <link href="style.css" rel="stylesheet" type="text/css">
</head>

<body>
    <div class="navbar">
        <div class="dropdown">
            <button class="dropbtn">Location
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="#" onclick="changeLocation('En',worldMoneySymbols.USD)">United States</a>
                <a href="#" onclick="changeLocation('Ja',worldMoneySymbols.JPY)">Japan</a>
                <a href="#" onclick="changeLocation('Es',worldMoneySymbols.EUR)">Spain</a>
            </div>
        </div>
    </div>
    <div id="revealView" style="height: 920px; width: 100%;"></div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>
    <script src="./assets/reveal/infragistics.reveal.js"></script>

    <script type="text/javascript">

        function changeLocation(lang, currencyCode) {
            sessionStorage.setItem('lang', lang);
            sessionStorage.setItem('currencyCode', currencyCode);
            location.reload();
        }

        var locationSelected = {
            "lang": sessionStorage.getItem('lang'),
            "currencyCode": sessionStorage.getItem('currencyCode')
        };

        (async () => {
            // this line changes the static texts in the UI
            if (locationSelected.lang !== null) {
                await $.ig.RevealSdkSettings.overrideLocale($.ig.SupportedLocales[locationSelected.lang]);
            }

            //set this to your server url
            $.ig.RevealSdkSettings.setBaseUrl("https://localhost:7111/");

            $.ig.RevealSdkSettings.fieldFormattingSettingsProvider = function (desc, context) {

                var settings;
                var selectedLang = locationSelected.lang !== null ? locationSelected.lang.toLowerCase() : navigator.language.split("-")[0];
                var selectedBadge = locationSelected.currencyCode !== null ? locationSelected.currencyCode : "USD";

                if (desc.dataType === $.ig.RVDashboardDataType.Number) {

                    settings = new $.ig.RVNumberFormattingSpec();

                    if (desc.fieldName == "UnitPrice" || desc.fieldName == "OrderID" || desc.fieldName == "Subtotal") {
                        settings.decimalDigits = 3;
                        settings.applyMkFormat = true;
                        settings.formatType = $.ig.RVDashboardNumberFormattingType.Currency;
                        settings.showGroupingSeparator = true;
                        settings.currencySymbol = selectedBadge;
                    }

                    if (desc.fieldName == "UnitsInStock") {
                        settings.decimalDigits = 0;
                        settings.applyMkFormat = true;
                        settings.formatType = $.ig.RVDashboardNumberFormattingType.Number;
                        settings.showGroupingSeparator = true;
                    }

                    if (desc.fieldName == "UnitsOnOrder") {
                        settings.decimalDigits = 1;
                        settings.applyMkFormat = true;
                        settings.formatType = $.ig.RVDashboardNumberFormattingType.Number;
                        settings.showGroupingSeparator = true;
                    }

                    if (desc.fieldName == "CategoryID") {
                        settings.decimalDigits = 1;
                        settings.applyMkFormat = true;
                        settings.formatType = $.ig.RVDashboardNumberFormattingType.Currency;
                        settings.showGroupingSeparator = true;
                        settings.currencySymbol = selectedBadge;
                    }
                }

                if (desc.dataType === $.ig.RVDashboardDataType.Date || desc.dataType === $.ig.RVDashboardDataType.DateTime) {

                    settings = new $.ig.RVDateFormattingSpec();

                    if (desc.dateAggregationType === $.ig.RVDashboardDateAggregationType.Year)
                        settings.dateFormat = worldDateFormat[selectedLang] ? worldDateFormat[selectedLang] : worldDateFormat.Remaining;

                    if (desc.dateAggregationType === $.ig.RVDashboardDateAggregationType.Quarter)
                        settings.dateFormat = "yyyy'/'QQ"

                    if (desc.dateAggregationType === $.ig.RVDashboardDateAggregationType.Month)
                        settings.dateFormat = "MMM-yy"

                }
                if (desc.dataType === $.ig.RVDashboardDataType.DateTime || desc.dataType === $.ig.RVDashboardDataType.Time) {

                    if (desc.dateAggregationType === $.ig.RVDashboardDateAggregationType.Hour)
                        settings.dateFormat = "HH:00"

                    if (desc.dateAggregationType === $.ig.RVDashboardDateAggregationType.Minute)
                        settings.dateFormat = "HH:mm:ss"

                }
                return settings;

            };

            $.ig.RevealSdkSettings.ensureFontsLoadedAsync().then(() => {
                $.ig.RVDashboard.loadDashboard("VisualizationsLoc", (dashboard) => {
                    var revealView = new $.ig.RevealView("#revealView");
                    revealView.dashboard = dashboard;
                });
            });

        })();

        var worldDateFormat =
        {
            "Remaining": "dd'-'MMMM'-'yyyy",
            "zh": "yyyy'/'MM'/'dd",
            "ja": "yyyy'/'MM'/'dd",
            "ko": "yyyy'/'MM'/'dd",
            "fa": "yyyy'/'MM'/'dd",
            "en": "MM'/'dd'/'yyyy"
        }
        var worldMoneySymbols =
        {
            "JPY": "¥",
            "USD": "$",
            "EUR": "€"
        }

    </script>
</body>

</html>